// Copyright lowRISC contributors (OpenTitan project).
// Licensed under the Apache License, Version 2.0, see LICENSE for details.
// SPDX-License-Identifier: Apache-2.0

#include "sw/device/lib/testing/test_framework/check.h"
#include "sw/device/lib/testing/test_framework/ottf_main.h"
#include "sw/device/silicon_creator/lib/sigverify/sphincsplus/verify.h"
#include "sw/device/silicon_creator/lib/sigverify/spx_verify.h"

/**
 * Generated using:
 *
 * ```
 * # Private key (not used, for reference only)
 * opentitantool spx key generate <OUTPUT_DIR> test_key
 * cat test_key.pem | tail -n +2 | head -n -1 | base64 -d | \
 *     hexdump -v -e '/4 "0x%08x, \n"'
 * # Public key
 * cat test_key.pub.pem | tail -n +2 | head -n -1 | base64 -d | \
 *     hexdump -v -e '/4 "0x%08x, \n"'
 * # Signature
 * echo -n "test message" > test_message
 * opentitantool spx sign -o signature test_message test_key.pem
 * cat signature | hexdump -v -e '/4 "0x%08x, \n"'
 * ```
 */
static const char kMessage[] = "test message";
static const size_t kMessageLen = sizeof(kMessage) - 1;
static const uint32_t kPrivKey[] = {
    0xa394f210, 0xa1bdbbe5, 0xb1aa0c14, 0x73c6a796, 0x728ac6b2, 0x7ac95a13,
    0x09d9a387, 0x357c0aee, 0x06087854, 0x77888c2e, 0x470385bd, 0xff4c21dd,
    0x0762f800, 0x941ff810, 0x9e5c319d, 0x02b75bd4, 0xa394f210, 0xa1bdbbe5,
    0xb1aa0c14, 0x73c6a796, 0x728ac6b2, 0x7ac95a13, 0x09d9a387, 0x357c0aee,
};
static const sigverify_spx_key_t kPubKey = {.data = {
                                                0xa394f210,
                                                0xa1bdbbe5,
                                                0xb1aa0c14,
                                                0x73c6a796,
                                                0x728ac6b2,
                                                0x7ac95a13,
                                                0x09d9a387,
                                                0x357c0aee,
                                            }};
static sigverify_spx_signature_t kSignature = {
    .data = {
        0xb9baa5db, 0x338a1470, 0x3ce3892b, 0x5ec25722, 0x8a0850d1, 0x26983608,
        0x7da6c82e, 0x9b9680e1, 0xed7edf1d, 0xb16c600c, 0xd4e125ca, 0xa25a2389,
        0x1ffde955, 0x9a2ece0a, 0x2b2281b4, 0xc5a8af75, 0xd5049257, 0x2abcd127,
        0x29bfd7cd, 0x17b19861, 0x2d24f4ca, 0xe30a719c, 0x7e9c96c2, 0xc7602c21,
        0x8f8bfd32, 0xa3e03242, 0x4906d407, 0xa5768ef4, 0x5cfd311b, 0xb1564e2f,
        0xd29a61e6, 0x63dcaf21, 0x660c9dc1, 0xb5cd1cfe, 0xc115aef8, 0x5840ac29,
        0x8b17d4aa, 0x9ba830f4, 0x5a458309, 0xf56de428, 0x5756fa17, 0x7242683b,
        0x6be664d3, 0xec810fa7, 0xad36d8c0, 0x1d16be22, 0x2f986200, 0xfa7d4782,
        0xa30efea0, 0x8074534a, 0xd0470119, 0xa06b9649, 0x3dc0ae17, 0xd27cecf0,
        0xa317df6d, 0xbe3b19ae, 0x8c0a68d1, 0x2c022c91, 0x4a4d39b3, 0xc6036fa1,
        0xc720a235, 0x8e29cd3d, 0xd0781d01, 0x72c5053c, 0xd61da436, 0x3af92810,
        0x42bf7bdc, 0x0b781138, 0xfdd2ae4c, 0x52334989, 0x5a3c9c59, 0x5e5184c4,
        0xda112bf7, 0x2812a1a3, 0x2bb1ac7e, 0xde2151fa, 0xd92e9769, 0x45a2f9d4,
        0x274e29b8, 0x1d275a19, 0xc477a322, 0xae4d3899, 0xde26bc11, 0x20d13766,
        0x97c4ccde, 0x00702f8a, 0xe568f767, 0x32d46acc, 0x779009c2, 0xc39b7004,
        0x174eddb1, 0x83c6580e, 0x5a7e3377, 0x020868dc, 0x433c9d14, 0xa7e13995,
        0x202c8219, 0x34f42360, 0x0bb1854b, 0x5f5c2b5f, 0x02aa19c9, 0x85611748,
        0x7660325f, 0xc84d46a5, 0x1753bd40, 0x59972838, 0x027bc6d0, 0xfcd836ee,
        0xa163e680, 0xab39b8a7, 0x7cdc2c50, 0x1cb95198, 0xb7456cc4, 0x9e56e696,
        0x5b26f338, 0xbfe62508, 0x8136c356, 0x607c3636, 0x2ab4a3c7, 0x6e1a362e,
        0x7ddd647a, 0x3ea7e495, 0x40ac832e, 0xb17b6878, 0x4dcf5b7a, 0x82b7c998,
        0x14f1386d, 0x7938e14f, 0xc171c07b, 0x0ff14bc6, 0x4468dffa, 0x2db905c5,
        0x6af62077, 0x2b2859ec, 0x50716498, 0x6bc03678, 0x29daa1c4, 0x25278723,
        0xaad5f25f, 0x67107e95, 0xbbf1a46c, 0xfc2da29f, 0x04a3c726, 0x88df39ff,
        0x60eddca1, 0x704da467, 0xc9888ba2, 0x821af889, 0x4bf3795e, 0xa049b250,
        0xbd041a92, 0xb790997d, 0xf42e0318, 0xd8a4f5fe, 0x63dd3265, 0x0f6646ba,
        0x97a903b9, 0x5cecb798, 0x298854c7, 0xfaa0c163, 0xbf5bb7dd, 0x7d48378e,
        0x42c19adc, 0x5d6e7a6a, 0x33d875f3, 0xeaf53334, 0x6152372b, 0x0a966473,
        0x9cbe43c5, 0x514c62cf, 0x179233b8, 0x4a2695e6, 0xfe17be76, 0xc2555152,
        0xfc79dedf, 0x1ea3f770, 0xcb4261df, 0x69e37c70, 0xfa41bdde, 0x57fb17ee,
        0x2d245708, 0xe0dc5586, 0xf7fb1b7f, 0x847a8bb3, 0x1dd130f0, 0xca3a8dc9,
        0xf219c84a, 0x49e13f5f, 0x758ec327, 0xaf7afd23, 0x2035f714, 0x03c5aa4b,
        0x30646578, 0xec23eb36, 0x0d87a5e1, 0x4f3b8e42, 0x90d49919, 0x3600046e,
        0x6d3d5e25, 0x691e4700, 0x7e6e9863, 0x50fd7985, 0x0cba7f36, 0x63e8a975,
        0x2cd6b256, 0x0565bcee, 0xbf1c7da4, 0xc3e93249, 0x7062f1bc, 0x6db0f261,
        0xc441edef, 0x4cf5a8f6, 0x78bca4eb, 0xcb9f0631, 0xc85412e8, 0xaaaa15ac,
        0xb82493d0, 0x0bafe7e3, 0xa3defb62, 0x7eb9f83f, 0xaf2320e5, 0xedd7287e,
        0x45f68995, 0x30d0f35d, 0x91f9a6f3, 0x209b70ff, 0x69227595, 0x03f97a89,
        0xb42fe2f6, 0x9083efc1, 0xab01cc2b, 0xc5835d92, 0x63ed0d2a, 0xcfe38266,
        0xc2a7ec86, 0x1e787a72, 0xd561caea, 0xa7374322, 0xa8dc0361, 0xb1d1961f,
        0x7c798e64, 0x8d213c26, 0x4f0d8354, 0xc334a3df, 0xefbce6f4, 0x926ee907,
        0x42a355e7, 0xd3dd3000, 0x072bc86a, 0xfd1c5d4b, 0x6a2b96e7, 0x9eae0efa,
        0x988e3b34, 0x207811be, 0x18cf61df, 0xe40d92f6, 0xe89154f5, 0x0be3d75b,
        0x63913b46, 0xf3609163, 0xd5eeba45, 0x79f39d8e, 0x792b4828, 0x00681165,
        0x80504ab1, 0x0c88bf3d, 0x00ee2266, 0x1dc9acff, 0x6b4bd9b1, 0x0f1b1c8f,
        0x9fe1b75b, 0xd6d3a582, 0xc30f7b1a, 0x8f1d2d89, 0x9827b893, 0xc128d0a5,
        0x9c3203b1, 0x48b5ff26, 0x9c6073bb, 0x1d44d7c8, 0xbcfdd38e, 0xd0375c93,
        0x9dd6aa6a, 0x7f49d3cf, 0xd4a2f506, 0x8b949ca3, 0x38c46270, 0xc142364a,
        0xe5e63c0d, 0x24bcb2bc, 0x7e884396, 0xa05ca7ac, 0xa24be675, 0x6d82b3ab,
        0x96d9ed5d, 0x2aaeffd5, 0x87cdfb9b, 0xaa95d134, 0x53b7dd37, 0xa5fdb2d9,
        0x01d76bb2, 0xf1ad9985, 0x5a31b25d, 0xbcf40944, 0xa82da235, 0xc4c6fff4,
        0xd3e838bd, 0x09115643, 0x3b2590ed, 0x4b6ec772, 0x2050fbe7, 0xa9fe03f0,
        0x1372b0ad, 0x0736d92d, 0xb371564c, 0x8ccf39b1, 0x8db02720, 0x680091a4,
        0x0ceb3a83, 0xd8b511f9, 0x394f39b4, 0x25c3a88a, 0x05478227, 0x5cc88462,
        0xb7b5c1ea, 0x305e96d2, 0xe094b73d, 0xf8784bd6, 0x9f4ba057, 0x4470c6d8,
        0x908a9c29, 0x5e927b3e, 0x23a93966, 0x7e0b62bb, 0x7b37d083, 0x59d8f7c4,
        0x19d3d1fc, 0xb7d03313, 0x82c9747a, 0x717f0c2f, 0xee6973bd, 0x017f1d4d,
        0x878e5c8a, 0x61210fb6, 0x1dd4befc, 0x3259b9c7, 0x964164db, 0x99a2bbc4,
        0x02c3ab2a, 0xea1adee1, 0xea88fbad, 0x625711f0, 0x1eb1e6cb, 0xe898293e,
        0x64194a28, 0x2cb98414, 0xf08a3929, 0x2df17926, 0x3b535d5a, 0x929d6d97,
        0x70c69d4a, 0xa267961b, 0xb7adaee3, 0x9eb234df, 0x0d182860, 0x912b9159,
        0x61512811, 0x018d6e0b, 0x84849543, 0xc97b27c1, 0x6ab8450b, 0xdbee3537,
        0x4264540e, 0xd116ab85, 0x65393754, 0xf3c15cb0, 0x8986190b, 0x078d687d,
        0x05044e95, 0xb3004727, 0x1e2d9e3b, 0x98adf63e, 0x24925212, 0x49af4171,
        0x4004e0c5, 0x72985623, 0x1a859882, 0x1523180a, 0x99a8dfa3, 0xe78ad59c,
        0xe7e07070, 0x5a016f34, 0xe1b8d535, 0xcb06f3eb, 0xf415385e, 0x384ec689,
        0xd17c8dea, 0x63596c06, 0x77d4fe0e, 0xcffdbd51, 0x92158434, 0xefabd728,
        0x0712abb7, 0xdc00e822, 0x4562e593, 0x7761a9f0, 0xd73216d7, 0x96354425,
        0xacedec68, 0x7773e174, 0xad997fa9, 0x49958398, 0x529e75e4, 0x8500f56b,
        0xaa31fda2, 0x9377babf, 0x2d445e36, 0x7f98f530, 0x37d20d1a, 0xb5e2ba7f,
        0x7c75bde5, 0x3b300a49, 0x2eedad61, 0x6eb379ad, 0xfce8dbd4, 0xa0058e0a,
        0xb82a8e40, 0x8df41315, 0x889c53b8, 0x31f64c35, 0x4bd8486a, 0x9fea5a98,
        0x84b8b165, 0xca19d4f7, 0x35667a17, 0xfd50a5f2, 0xd7be7051, 0x08491b0e,
        0x61fa478f, 0xf544af21, 0xe0e518ac, 0x5b8e9c77, 0x6859d8df, 0xc4bbeed5,
        0xb9b781a2, 0xe5038a70, 0xf73e3d2f, 0x85b25111, 0xfecec67f, 0x504c330b,
        0x8c85b5a2, 0x62fd4087, 0x96f8db7e, 0x7e8a8e49, 0xf608922c, 0xa4e1307d,
        0xdc5a1ffd, 0x4da1279e, 0x2688325e, 0x4cee1c83, 0x65dce20b, 0xf5557cee,
        0xa6826f58, 0x49044570, 0xa4e4e20d, 0x35d710cc, 0xb342b864, 0xb5eefd2b,
        0x586082f4, 0xe9e76ca2, 0x0a99a4b2, 0x6d43668e, 0x0935e1c5, 0x1e3f3720,
        0x1e9408c7, 0x3d0321c9, 0x820facc1, 0xd1b73a08, 0x0683c82d, 0x4d31542e,
        0xf7304030, 0x39bbed70, 0xaa1bdde4, 0x8e6e71e7, 0xd0ea4e53, 0x003bc17f,
        0x82bbe131, 0x684ff08f, 0xae069344, 0xfaab399a, 0x1df0747a, 0x834042bc,
        0x5849f76a, 0x21e09b7c, 0xe5348567, 0x519421ae, 0x94bc7552, 0x5a891f35,
        0xb6c530b7, 0x2af6df3e, 0x23610dd0, 0x21419cc4, 0x146c8236, 0xb6183882,
        0x0f930538, 0x95f82087, 0x4439f306, 0x971df626, 0xeb49bd66, 0x4f80f13d,
        0x1a9bbfd2, 0xe1449d2d, 0x6c91cd49, 0x65b6b89b, 0x207b0a70, 0x0fea4a66,
        0xb2f33574, 0x254d27d2, 0x76044a4b, 0x79d711d9, 0xbdc56289, 0x98708e31,
        0xc9818a97, 0xb85260e6, 0x94eeb6ce, 0xb4459e8a, 0xb9c5d8ea, 0xfce77e3d,
        0x38ac8e8f, 0x655da63e, 0x1b7f30b1, 0x5c9bd006, 0x7ab0434c, 0x3394f54e,
        0xbe8bc82c, 0xd1451d74, 0xd49767ee, 0x66561326, 0xa5c33954, 0xf89f6f04,
        0xfe0d30ff, 0xf5ea53f0, 0x8a9141ad, 0x25c30f0e, 0x41dcb586, 0x907936e9,
        0x92d29316, 0xa12e0971, 0xe96b8a9c, 0x4fce694e, 0x7bbbbb10, 0x2b6a029b,
        0x64d6260c, 0x5fbde6df, 0x66ac35f3, 0xf163c202, 0x246f7e1d, 0xc9b3442d,
        0x76e4641b, 0xb1216839, 0x888c84ee, 0xdeaa1ecb, 0x051f3c71, 0x0899c59e,
        0x1bef588f, 0x72837a6d, 0xb1aa188b, 0x80cd8f00, 0x137d1244, 0x7c909a58,
        0xfc4d83f1, 0xa9e2893d, 0x8b3586f2, 0xfe71021a, 0x49c1e9eb, 0x1718fb46,
        0x51a6d413, 0x2ba4f7fe, 0x01c9d08c, 0x6d53f323, 0x587620ec, 0x917a7cb3,
        0x8eb7156e, 0x05f4add2, 0x0d4e24b1, 0x7fb4d457, 0xab785d0e, 0x35f40fae,
        0x7d9c6d82, 0xc883d8c6, 0x59dc53ce, 0x314f4be6, 0xf393daed, 0x56f25f47,
        0x9166ce79, 0xd45099e0, 0xb33241e6, 0xc0e7f412, 0xb256e017, 0x4c25c853,
        0xb61423af, 0x9711ef04, 0x8974b011, 0x74ad8617, 0x8519902b, 0x2a44b2e9,
        0x1910e2b2, 0xf34f7a36, 0xcbf45478, 0xb2218663, 0x839a131b, 0xea848ca3,
        0x16082d9c, 0x00b0463a, 0xf5a4d6be, 0x3e2f9cf5, 0xc52dbbf2, 0xf39ef919,
        0x26154ba6, 0x1fa33d5d, 0x03226a0f, 0x23cda919, 0x540969cf, 0x78d14c21,
        0x5eea2c68, 0x6431a2ac, 0xe51ca532, 0xa156b888, 0xae9ba43d, 0x14b34ea3,
        0x004f0bf9, 0xdc18a7b7, 0xd3b6063b, 0x55e53ca4, 0x1f1ab2e8, 0x005c2895,
        0xab03ef29, 0xcd125100, 0x757aa543, 0x990099b5, 0xaecb2b26, 0x8a343bf2,
        0xcccbd3c8, 0x99b68b12, 0x274494a6, 0x1d5d9ed9, 0x6c3c5ec3, 0x94fa506a,
        0xbc3a83f6, 0xa3b1e90e, 0x62d05a26, 0xd8207067, 0x3d8542fe, 0x1989b927,
        0xfbba0ba9, 0x374e54fc, 0x51c1c1d9, 0xb2ceee67, 0xb4a2afee, 0x65166220,
        0x2c5cd517, 0xc68afb04, 0x974821d2, 0xd625d474, 0xb3a62baa, 0x84e4b79f,
        0x1f4d4c1b, 0xe6b9067d, 0x2164640e, 0x384ada70, 0xef892a53, 0x5b3cc34e,
        0x5a5052e4, 0x7b944d24, 0xf8be3d40, 0xe0543f05, 0x0c57b32c, 0xbab8a0c7,
        0xe756767a, 0x7820da08, 0x0a0de598, 0x5dd5052d, 0xe0893f5c, 0x1d6f74ba,
        0xe17e5a6f, 0x1fa72fea, 0x352226aa, 0xb173c42a, 0x0f398152, 0xce4c0cd1,
        0xb7c8973f, 0x8538cdd5, 0x21d20600, 0x832db170, 0xc54697e9, 0xbd916d84,
        0x5ad9fb95, 0x83e8a863, 0x2b544873, 0x92f013c2, 0x280fd9eb, 0x1a396bbe,
        0xeed826a4, 0x149d0205, 0xb9e38914, 0x5c7c1c11, 0xc2e9c751, 0x98b99b42,
        0x712ed06d, 0x5c59e9de, 0x13724f13, 0x43fb3452, 0x9c1c926c, 0x417fcd4a,
        0x82f92075, 0x4f9c5a66, 0x84de1202, 0xa9085497, 0x86dd12b7, 0x8b14bda8,
        0x48d442d5, 0xf6e70dee, 0x8151fcfe, 0xee940b9d, 0xb2b58868, 0x58585671,
        0x6bae575a, 0x017b5e29, 0xf18fb3a4, 0x936375d5, 0x951c089c, 0x83771f67,
        0x9ef38841, 0xe6a52bc8, 0x9b3c9c61, 0x550edb2c, 0xca7bb2e2, 0x639a59b0,
        0xb3d3b15f, 0x04768bcf, 0xb486cdce, 0xb1c19b0b, 0x10260135, 0x0e8436aa,
        0xf358e501, 0x515a023f, 0xab5e6222, 0x479f68ec, 0x7bb6615d, 0x3a9bd778,
        0xe3026537, 0x719c2bb9, 0x887ac463, 0xc5b39c07, 0x9faedc44, 0xe83ef4fd,
        0xcc312c50, 0xa1ec5565, 0xd3a9f69f, 0x8addd5dd, 0xee26f112, 0xb7ba67ab,
        0x931122fd, 0x5e67c9a8, 0xc378a5f5, 0xcf9aa57c, 0xa8c8bfdf, 0x8b5da722,
        0xda95caf0, 0xac37e418, 0x3f45444d, 0x61c885d7, 0x03308999, 0x71e8224d,
        0x83706fcf, 0xd46f1268, 0x64681136, 0xf09f6080, 0x5f3f9e9d, 0xd99aa525,
        0x82ec644a, 0x280ea2fb, 0x0f4e9150, 0x2d5d72fd, 0xcf8f94d5, 0xdc649fb6,
        0x04b4d7b3, 0x3570a226, 0x8010da49, 0xb33d0456, 0xdf121b30, 0x27b8f341,
        0xda8641d3, 0x30e6e5d4, 0x3734adbd, 0x1f9a531d, 0xadd686bd, 0x3b8074c0,
        0x7b4f2e36, 0xe4814947, 0xeafa1ea2, 0x4c53a9ac, 0x52738ad9, 0xfd0c9923,
        0x2e72fdca, 0x04d4f807, 0x8336d903, 0x587cf4c5, 0x52bbe27b, 0x1cfd3fb1,
        0x7aa57fd6, 0x23f49b77, 0x0f1859c1, 0xb16d2aa7, 0xd0253923, 0x4d314522,
        0xc52e9a20, 0x94c139eb, 0x5af95b2b, 0x07e83139, 0x1eb344df, 0x49a00058,
        0x4d97a46c, 0xee18528e, 0x585ded8d, 0x624bd229, 0x502dd6cb, 0xdbe82e17,
        0x5e434bcc, 0x9dc7ac26, 0x9d658740, 0xf2403976, 0x35ee17ff, 0x224efd2b,
        0x7bac4e24, 0x48f19efd, 0x9c940590, 0x4154753b, 0xde5c01ee, 0x417bbee2,
        0xdbc0c3ac, 0x7e73161b, 0x97653dc7, 0xe262b82b, 0x25f19915, 0xcd0b23fe,
        0xbc8be49c, 0xdc4c3edc, 0xbcfc2f5c, 0x874468d7, 0xeb676516, 0xba9493bf,
        0xb1c1fd0c, 0x47650536, 0xc2d2c60d, 0x051ca394, 0x86d676b6, 0x83f5e815,
        0xd6a1b46f, 0x42aa072e, 0xa874b804, 0x2d19f3e5, 0x845c0742, 0x5cde940f,
        0x73683a9d, 0xe6d2154a, 0x45705102, 0xc3dca067, 0xa9e93b7e, 0x60eed32f,
        0x70f421a8, 0x71cd3b61, 0xde17a178, 0x54d46711, 0xcdd7b95b, 0x4ffff617,
        0x147c5d4b, 0x23c8b90b, 0xc287e988, 0xfde6b521, 0xfd91498e, 0x0fb2788d,
        0x8bd0e734, 0x093e90d5, 0xe72b9519, 0x296c2839, 0x34e295dd, 0x1755c85c,
        0x7c2b133b, 0x3a285157, 0x66a3f7a9, 0x2dffee6e, 0x6de6930e, 0xc8827169,
        0x10356ea8, 0x41d4dc0e, 0x92ec59e4, 0xa7896dd9, 0x3e52361d, 0x9331b7c6,
        0x04f16cf5, 0xd56f3b9d, 0x3fa76a08, 0xdbc030d5, 0xb8181464, 0x28dbe0a9,
        0x95f3f421, 0xd38f2eb6, 0x4d9d853f, 0xab24e479, 0x61f8c3bb, 0xac78ba70,
        0x81532b08, 0xb90d3b9f, 0x96375c50, 0xe246ccc7, 0xbfe438bd, 0xa62024b0,
        0xf16d5b63, 0x227400c8, 0xadef5129, 0x10386767, 0x68f44ba1, 0x82d1f171,
        0x495af2f9, 0xcba6abc7, 0x7bb86096, 0x6660d789, 0x8a0c10f0, 0x9bcea0f7,
        0xda8d0ef2, 0x53afc357, 0xca7c68d9, 0xadf64503, 0x0bd4bc76, 0x7401645c,
        0x405a734d, 0x90471069, 0x64266ce0, 0x3d409067, 0x33a8cf9c, 0xee7b54d8,
        0x7f7a5213, 0x42caae59, 0xc5229141, 0xa581c125, 0xa832caba, 0x6b06a220,
        0x58ef395d, 0x7fd53752, 0x99bb9979, 0xd8b08f2f, 0xbaccab7f, 0x7ebf2618,
        0xa4430db3, 0x575b02ea, 0xa54a1fdc, 0x5c866432, 0x48559c78, 0x0b8ec41b,
        0x51a305d0, 0x5bfc927e, 0x4c6251db, 0x93f86cb4, 0x16ba143e, 0x93f67567,
        0x966ba862, 0x8d920ce8, 0xa10660b4, 0x7a9e04aa, 0x128d9d56, 0x3d434920,
        0x2bcd0256, 0x524db41c, 0x78047007, 0x6145bc41, 0x7840fb19, 0x995eebd0,
        0xfea5fb09, 0xcdfeab66, 0x5154e262, 0x98fdf8c1, 0x0e6cec61, 0x9e573b86,
        0xc532bacd, 0xe76e8880, 0xe6280882, 0x9746d6e0, 0x883b08a3, 0xf107a214,
        0x9965071f, 0x82579463, 0x4c97e65c, 0x9f18e7c5, 0x74963ef2, 0x219931b6,
        0x753cbd8c, 0x6285b768, 0xfffb64a3, 0x08db7f1d, 0x56631f62, 0x17e003c7,
        0xe0fda263, 0xca001b22, 0x076b73c9, 0x4959cbc8, 0xfb301362, 0x02d2b1c9,
        0xb1561e2d, 0x703345d6, 0xffd5cdd8, 0xb870d51a, 0x7befa99c, 0xf60f5b9c,
        0x39f74308, 0xe51b4446, 0xf049d3c8, 0x47d31544, 0xfa8e5663, 0x0b66cf52,
        0x44b986c5, 0x7903d9e8, 0x569ab297, 0x9acd1ac7, 0xf02b8e8f, 0x82e5b079,
        0x65097aeb, 0xbc67660c, 0xd7bd5d02, 0x630ef220, 0x6f66db95, 0x9ef97998,
        0x2218c55f, 0xbeaecd66, 0x0f859424, 0xa04025df, 0xc1e3abc5, 0x5d47bf1a,
        0x3ce28646, 0x53f8fc25, 0x88eef60f, 0x50716a7c, 0xf0f10a83, 0xa729800d,
        0xb3a8242e, 0x179bd299, 0xfc28830f, 0x3463956f, 0x57357922, 0x1e376d67,
        0xd80879dc, 0xd59a8e21, 0xd7c0d98b, 0xd0ba5c1d, 0x1e483538, 0x00622d0a,
        0x5390d847, 0x8c9ee76e, 0x2656f2d0, 0xfa7f92b2, 0x7580ac1e, 0x9fe26b04,
        0xe8dd627d, 0x1f092082, 0xf71f5873, 0x210e9e2b, 0x799e587f, 0x670282d5,
        0x7778c6ac, 0xdf047ad1, 0xd10f6c08, 0x514d6aff, 0xc45929ee, 0xf256e6bb,
        0x0eb8e26d, 0xa3877fa4, 0x7fa459fb, 0x348df22c, 0x3306ee66, 0x20aa73a1,
        0xec175834, 0x4483f394, 0x1f90f005, 0xc8d34185, 0xb722aad7, 0x1ea5df1d,
        0xd4f2bf87, 0xd3381dbb, 0x33866022, 0xbe99c28c, 0x6755a399, 0xcae7710a,
        0x06f657c7, 0x592245f1, 0x93da15c1, 0x85d38f9c, 0x1f6b21bd, 0x2ea2089c,
        0xf09e44a1, 0x6eaecda9, 0xa160cd98, 0xb4a9709b, 0xea86fd5f, 0xa200b83f,
        0xa7a448b1, 0xdac6e857, 0x65b72c5a, 0xa2322733, 0xfd13cf87, 0x71bc4516,
        0x655f6607, 0x59fe4dda, 0x5d714032, 0x0a39fa5a, 0x603729ab, 0x8364a873,
        0x8a02e2bb, 0x04f911c2, 0x29cbcd02, 0x06ad19e1, 0xf8a9ff11, 0x5fd0c701,
        0x9e2b34e4, 0xd0689cd2, 0x52da2bc9, 0x4ccb3cc8, 0xf2d1d71b, 0x3e98c084,
        0x24515be6, 0x428bcb8b, 0x4435965b, 0x042f73ae, 0x2d49bbc8, 0x51399855,
        0x598d9b5a, 0x2efe24c0, 0x7158e4ed, 0xde291716, 0x0eb80808, 0x80f8b7e8,
        0x84c87d2c, 0xfd83eb7f, 0x6cf79368, 0xba75399b, 0xd2c30484, 0xdcbed1b4,
        0xacc0bab4, 0x51559992, 0x7e8d4918, 0x10d32675, 0x91281152, 0xcc0bfd54,
        0xd3298127, 0x453825d7, 0x5b30e747, 0xc629e9b3, 0x70cee9fa, 0x5fe3f926,
        0xc5d2b736, 0xe34fb521, 0x0363b53b, 0x55de5d36, 0xa859962a, 0xc5b257eb,
        0xc1dab47d, 0xd972667f, 0xf7940a86, 0x0a5c4e03, 0x4cb7bc2d, 0x6b72b915,
        0x5bbf96a6, 0x9c973c38, 0x18e9a3d3, 0x189a8971, 0xfa7b4d5e, 0x78eca9d6,
        0x1809a593, 0x80f94c5f, 0x6738a450, 0xc7712a6f, 0xd3d3039d, 0xa391ce0e,
        0x9c8d04f7, 0x5ce17f03, 0x1d2de30e, 0xb91b07df, 0xc3b4ab9f, 0x46af4879,
        0xa5d85a7e, 0x0445c710, 0xb7de2d84, 0x75183be5, 0x2d286e14, 0x0fd3377d,
        0x2b0b3aca, 0xd74b6ec3, 0xa255f11c, 0x4f3a8c56, 0x6cba9c0a, 0xbcc04ac0,
        0x32cfb74a, 0xaf682c15, 0x6a52f29a, 0x835234ac, 0xd6410507, 0x64a47675,
        0xc8a16aa9, 0x2bb0f6d2, 0x71f33e78, 0xc5144fb5, 0x466953cc, 0x24ebf116,
        0x2b6fabcb, 0xc94a0e0c, 0x6ce458da, 0x5a2b53d1, 0x1ecfca6d, 0x03ea61a4,
        0xd707ce4d, 0x59da1cf0, 0x793335e6, 0xdb5bfa32, 0x69abc787, 0x023ee2ca,
        0x503e8056, 0xfdb571ab, 0x0308da95, 0x4245b8d6, 0x1c7005fe, 0xa9dea1a6,
        0xa01b133b, 0xa4aa57fd, 0x9d45f5b7, 0x7ba0cf42, 0xa2d2c00b, 0x874c84fb,
        0x1bd24d7c, 0xd38b16ab, 0x4af06b08, 0xb7f4bc7f, 0xc65dec1a, 0x02493e01,
        0x343f14f2, 0xd92bf41f, 0xf01416f1, 0xa97d9448, 0x65d0b7db, 0xdef91f05,
        0xbb8f243c, 0x7f76e0ea, 0xe6e5521b, 0xe60e1a21, 0xf9a9ea8b, 0x66f45c7b,
        0x21605d4c, 0xe59b0cf3, 0x76424c9b, 0x39fc3ee1, 0xf83e8dd5, 0x3c573fad,
        0x8ba8558f, 0xa8c30b99, 0x32f90263, 0xd40cec20, 0xe8d6ddfd, 0xe63e0d25,
        0x4cd53943, 0xb49d0419, 0x62da92a1, 0xae8be7fd, 0x6495d53e, 0x71849450,
        0x61b5acf2, 0x1af2c0b0, 0x2daf8e1c, 0x18fac4ec, 0x3899ec06, 0x0cea54f1,
        0xefde1b64, 0x7323fdae, 0xd911cbd7, 0xf6e2da32, 0xe2ac0262, 0x36c201d1,
        0x3f513462, 0xb513d7ce, 0x5563a4f3, 0x25da7a70, 0x6be558cf, 0x2ebb137e,
        0xc6739524, 0x88262c2f, 0x8fedb7a5, 0xb4fc08aa, 0xd1793680, 0x60cb96d2,
        0x88076bb6, 0x868db88d, 0xa15222fe, 0x0df45605, 0x1665b66f, 0x73fb1c7d,
        0x05beb924, 0x57579006, 0xd542e5fd, 0xf4ca14aa, 0xea51f5b7, 0x77038ec4,
        0x6c0acf09, 0xc93768a6, 0xc3c6d7fc, 0x4ee8b814, 0x9c99af24, 0x131694cd,
        0xf95c2f4a, 0xd9aca1bd, 0xb6bbaaa1, 0x49cdfdf7, 0xefa86a85, 0x0b7ed1c9,
        0x90f82b54, 0x128e9816, 0x518ab7f6, 0x102e9df4, 0xf688d0bb, 0x3e176bed,
        0xa7fc14ee, 0xb75e9327, 0x82f4ce4d, 0x4e351313, 0xfe8ab6d8, 0x89ced6b9,
        0xb28e9b70, 0x5a8c27ee, 0xfae8ecc4, 0x45d19c19, 0x8e43063a, 0xc677233e,
        0x9773fa59, 0xcf0385a6, 0xf352e252, 0x4f634d12, 0x941431bf, 0xdf986abf,
        0xaaaf4ca2, 0xe18146d8, 0x2f7cd9ff, 0xbb790e30, 0x864be1cb, 0x6343dabd,
        0x8ecd919a, 0xe6220ccd, 0x3975234f, 0x8ba8b1a4, 0x167b786f, 0xed402a4d,
        0xebd033f3, 0xaa364f82, 0xe8913ac3, 0x6a7fcd71, 0xdb4b087a, 0x9f098e50,
        0x65a2a0df, 0x857076b4, 0xada183a0, 0x5e524dd2, 0x85d62610, 0xdb239f5a,
        0xae49f7c6, 0x6b4b9e65, 0x235fd42d, 0x38e743c6, 0x2855eb72, 0xb961e5a6,
        0xe4c3898c, 0xfda111df, 0xc84f2a85, 0x3cbbf4cc, 0x22b2ab64, 0x753483c8,
        0x3e4335a0, 0xab4470c9, 0xcf3c3c2a, 0xa707481a, 0xec245da3, 0x2d90ee18,
        0xb0348fff, 0x791f401a, 0x2dadf7c9, 0xeb98fff2, 0x272747be, 0xaf44d5f3,
        0x35796b06, 0x5416aac1, 0x87a54ff4, 0x699015c8, 0x96f787d4, 0xcedd5fc5,
        0xb2e6c717, 0x515de036, 0xbc7b3eba, 0x25fc58a9, 0x890d45a5, 0x9406a97c,
        0x22c3e722, 0xc2609dd2, 0x92c7994e, 0xb7fa82ff, 0x389c1d97, 0xe1c6591c,
        0x21f0fe2e, 0x91490c73, 0xf15a9814, 0x57183278, 0x7591e5d8, 0x4f59a325,
        0xed9940c9, 0xcff3e132, 0xb9716fcc, 0x66ea1c09, 0x94e4075d, 0xff619272,
        0xf8a5f723, 0x38339f4b, 0x68b2fa96, 0x3bb57afc, 0xe4ddfe5c, 0xca0574d7,
        0xb11f6766, 0x78354af8, 0x2e37c98b, 0x3268c091, 0x92488c0d, 0xf432359a,
        0xde53c29b, 0xf8afb6fc, 0xcd2b4b26, 0x4b09c417, 0xe2a59a44, 0xeb376626,
        0x3bf3f312, 0x06a41f7f, 0x4059874d, 0x3c361161, 0x8f2c7d12, 0x0e450314,
        0x468cac54, 0x075c1d39, 0x6aa757f9, 0xc82adb66, 0x4144ed48, 0x055a27e5,
        0x2b9d555a, 0x454caa2a, 0x8e5a0848, 0x0dadc843, 0x0670839b, 0xe15b18b2,
        0x6326ff65, 0xc84c274f, 0xf4e892c0, 0x50f82f33, 0x3d75ed51, 0x5e2c7c70,
        0x8f405b20, 0xbae1ad8a, 0x3b6c2d70, 0xea300047, 0x418bd3d1, 0xf92269ad,
        0x8e8c8e5e, 0x706618fb, 0xc5fcfb05, 0x14a293bf, 0x6ca16050, 0xa093f3f5,
        0x9e6446ec, 0x45194f20, 0xbeb35df3, 0x13375db9, 0x62a8ffc3, 0xc78c255d,
        0x89fbcfd5, 0xf5689d60, 0xabb590cf, 0x41e6e0b7, 0x674dd52c, 0x72e06607,
        0x034dbe22, 0x90e8c783, 0x8c6f0ce0, 0x108da13c, 0xb0bcc249, 0x02ce8fdb,
        0x67892f93, 0x61b103fa, 0xb5da5b73, 0x6427bdfe, 0xb353d125, 0x3eb75ada,
        0x19d5700c, 0x0b07440e, 0xfc967daa, 0xd8d06817, 0x8ce1a27d, 0x034dff38,
        0x721e6e7a, 0xc096abf7, 0xaaefaa2a, 0x2988b974, 0x098f0364, 0xf4750259,
        0xc324ae07, 0xc853c5d9, 0x1cc4a954, 0x7651c72c, 0x59eefff5, 0x5987caa5,
        0x089aa371, 0xdba3ae37, 0xf5ce8944, 0x6a1a8e96, 0x191774f2, 0xf5c87fca,
        0x318345a6, 0x2512722a, 0x3fec9931, 0x45e720e9, 0xcbd40a88, 0x0b4ba690,
        0xccb2dce3, 0xa7c1e4b6, 0xf4030a27, 0x32b72df9, 0x0b21023f, 0x4f99b705,
        0x0a7da8ba, 0x13c24488, 0xad9d55b6, 0x43fc1624, 0xfc22f3bc, 0xd6daa99f,
        0xe034b9cb, 0x1e4d172f, 0xd661952c, 0x8617a7ef, 0xc87f914b, 0x05fc0711,
        0xb684838b, 0x784f53de, 0x2a16b3dd, 0x273eae62, 0x0adc54c9, 0x6c338c01,
        0xda588718, 0xe1da5375, 0x6a9aa550, 0xe7599670, 0x29c3d382, 0x6db7d4fb,
        0x7206523c, 0xca9f67e5, 0xe2c0d1af, 0x60348369, 0x9d23e731, 0x33dd9a8e,
        0xf8cf11f3, 0x12a265aa, 0x52e2edf1, 0x8d7191d1, 0xb3058203, 0x56db13df,
        0x0efee52e, 0x91cb351c, 0xfeefe2fd, 0x8b0be83d, 0x326bdd29, 0x1d04492f,
        0x7aa34b94, 0x05660ed8, 0xfc3af971, 0xe515e036, 0x61d39540, 0xb58a905b,
        0x756b6d8f, 0xaff81ec0, 0xbd221e84, 0xe20d6459, 0x4216e6b7, 0x41d10a45,
        0x79a87a42, 0x3b7b325d, 0xf42bda8a, 0x25e7f479, 0x6d71e8c5, 0x893f0663,
        0x3a5eb723, 0xf261c603, 0x234fd3dd, 0x07a68161, 0xc4d6051f, 0xd6bb5912,
        0xfdd3c471, 0x94e61ab2, 0xe50c95eb, 0xf0814360, 0xe632bf11, 0x9904d9bf,
        0x0bffce32, 0xb4be9b2b, 0xef15f6ff, 0x88e16905, 0x9c7dc5e1, 0x83e37c04,
        0x244d8fd8, 0xbe69bca5, 0xedcda94d, 0x84adb1e2, 0x6b63ed69, 0xa7eb4c8f,
        0xc31d5a56, 0xbb4304a7, 0x184465f4, 0xef4b1c4b, 0xe4893aa5, 0xa86de118,
        0xb3a7cad1, 0x0f4efe42, 0x33dd917c, 0xfbdb20d8, 0x040920c6, 0xfcc54596,
        0x26e23e93, 0xa9496e51, 0xc339cd39, 0x2ba696e8, 0xe204d894, 0x962353ed,
        0x7674401d, 0xe80ec224, 0x3e1929eb, 0xdf113e38, 0xc24fe168, 0xe0dbadb2,
        0x7b7f4e6e, 0x32674bfb, 0x823f60b8, 0xb81a058b, 0xe9158323, 0x18c8117e,
        0xc1063c86, 0xebe9c9d2, 0x426ca47b, 0x177c1cc7, 0x054c1e40, 0x567fd809,
        0xff38a74a, 0x0e236d5e, 0xe4a6c49f, 0x9ff835aa, 0xa402f132, 0xc2cd9dc2,
        0x10363416, 0x004f376c, 0x362d854f, 0x5a3cf75d, 0xe280fe98, 0x7801c0f5,
        0xbcbf9002, 0x0ad4e6a1, 0xf1bf1f88, 0xb883065a, 0x6807e99c, 0x6b1841fa,
        0x314c8f8f, 0x5e2c47e7, 0xa8de7bbd, 0xf74f65b8, 0xa674d56c, 0xb65b71ee,
        0xa879ef96, 0x16764fd0, 0xd218a054, 0x90714f43, 0xcb922662, 0x5862b186,
        0xf9f5087f, 0x1446d73e, 0x63430087, 0x55da33aa, 0x5f025a3b, 0x83b42e32,
        0x3c723546, 0x6718b0bc, 0x0d82ea15, 0x1350f4b7, 0x33b9c9b0, 0x0ac4b9d9,
        0x7aa37c91, 0xb6bfd613, 0xbb1dc34c, 0xd2c73eda, 0x6a3dc85d, 0x8e7ad73d,
        0xd343efb0, 0x7d45dddb, 0x6ff90305, 0x63c0f999, 0x9bbf1c2e, 0x9e2dab5c,
        0xda191d36, 0x81efdcba, 0x167b38eb, 0x12bdef72, 0xc0f99a05, 0xcb832d7f,
        0xd358ff33, 0x3c0edea4, 0xc1d97d1f, 0xd2026494, 0x5808b402, 0xf9eadaec,
        0x10001b06, 0x27b3599a, 0x5659fea7, 0x70e50d86, 0x3aa87f6e, 0x1b230ddd,
        0x67f031d4, 0x38063287, 0x91b619b8, 0xfe03f26c, 0xedf25c0b, 0x91c36055,
        0xf5113c16, 0x712e6a31, 0x1a2c49da, 0x7eb182d5, 0xa120e4f3, 0xc1f56112,
        0x07e5c0d7, 0xd91cd688, 0x9667da47, 0xcb7446ca, 0x70e56c6f, 0x0878f951,
        0xd97306ad, 0xb561f175, 0x8eaa4364, 0xfedb98da, 0xb1803d89, 0x4f79369f,
        0x7c1c1d86, 0x8ff94468, 0x60727df3, 0x4f3b4bb2, 0x00c03d61, 0xdf4fb9b3,
        0x92ca26a5, 0x846450ab, 0xb72eb77b, 0xe9ddcba2, 0x5d57de17, 0xa2b83ded,
        0x4e37aceb, 0x60045a3f, 0x81af5cdf, 0x43ecfc30, 0x7388feac, 0x142c479e,
        0x72ac33a0, 0xac4804db, 0x2bd34f55, 0x426ec754, 0x4a550570, 0x89ccb4ce,
        0xa5b1478b, 0x2edd70d9, 0xd353a57b, 0x0ec1370f, 0x0c98d6dc, 0xd6aa3d9d,
        0xb218ab98, 0x794ebbc3, 0x93697b76, 0x7d711549, 0x2c4f953a, 0x3efda99a,
        0x68eba110, 0xfc5a3892, 0x4f6df844, 0xeb08beb9, 0x6c11face, 0x6503a90c,
        0x917b61ba, 0x7ee1f79a, 0x80f0d6d6, 0xbfb5741b, 0x25e47173, 0xc9a63677,
        0x994e667a, 0xc0c9120e, 0x4c7832a5, 0xbf13ba83, 0xa61f5866, 0x5a6e90cb,
        0x08d4fe5c, 0x1beb4883, 0xf49b6a67, 0xdc0668d0, 0xca802eab, 0x99b144c3,
        0xc2ecf7d7, 0x8fa9c79c, 0xedbec713, 0x8f82a8c9, 0x72fda1ec, 0x8a6c8640,
        0xaf7c87b9, 0x8bbcd184, 0xd1d9d1ec, 0x08ab4390, 0x27126223, 0x409c509c,
        0x9fcb2bcd, 0x4e2c3dcc, 0x05871975, 0x126b99b0, 0xd6d37927, 0x017c05e0,
        0x72d8e5cc, 0x9504fe3e, 0x8cb10340, 0xf7e4e2c5, 0xf4a9ef1b, 0xc1083fad,
        0x310a789c, 0xa89fc5b0, 0xa44258c0, 0x2c837e43, 0x673f1e6a, 0x5a686581,
        0x04076ae4, 0xa8dce628, 0xf2589e7b, 0x5bee1fdb, 0x9f4db650, 0x7c04e914,
        0x6f06772c, 0x70f529db, 0xb2e60e3f, 0xa0e890d1, 0xac8cbd7b, 0x49d8f17e,
        0xdd9c2e18, 0x5cbcce3d, 0x43f6d9c7, 0x31905451, 0x42f56eb8, 0xb752c0df,
        0xb73360de, 0x9b6c67c3, 0x72ff8a27, 0xf06c0a13, 0xfe5ca992, 0xac2497f9,
        0x7748d68b, 0xc2b68912, 0x8e200f83, 0x03d9fc1f, 0x409bebba, 0x986d6272,
        0xaf85078f, 0xbd7ec4a9, 0x695dfc58, 0xc4086595, 0xe72a3879, 0x2e827aa2,
        0x47c2af05, 0x700969ea, 0x200b9d4c, 0xd3ef5f86, 0x5578a990, 0xda40488c,
        0x9a5e2aff, 0xd83838f8, 0xb066a9a5, 0x63f76a40, 0x475c42a5, 0x76b6a349,
        0x1ed5abe1, 0xfe473ee9, 0x50bea624, 0x363bd85d, 0x01a90767, 0x1cf32fff,
        0x9ef35318, 0x7f64a513, 0x5fd177ea, 0x5e791f8b, 0x5017d2be, 0x196e538f,
        0x12837d19, 0x69adc987, 0x734c1ebd, 0x57c791c4, 0x31eee6a1, 0x81411e17,
        0xa0a2f943, 0x4d732a67, 0x425fbb5f, 0xbded7382, 0xa458a9fe, 0x76f4e1b0,
        0xd1d486a9, 0x861a9f9d, 0x167360f8, 0x4c73b5a9, 0x54c48379, 0xed5252ca,
        0x979aecaf, 0xf90e1dca, 0x43c230f9, 0x849d5c85, 0xaa2e4714, 0x4dce7b60,
        0x6a76ed9b, 0xdc86af2d, 0x7bb21d50, 0x9c240d83, 0x741480c3, 0x15717aa5,
        0xc9ec7346, 0x53b148bc, 0x80554304, 0xde7a193a, 0xe3f2f329, 0xac8b1475,
        0x77f60f1e, 0x69581e46, 0xdc7e0ecb, 0x5dbf64e3, 0x490e948f, 0x245bae8d,
        0x051b8a87, 0xa40b4f45, 0x6a26af91, 0xdeda8246, 0xe7b1c124, 0xc6d6cf4d,
        0x5bfe0af8, 0xc5f671ed, 0x427d44bb, 0x7d17749f, 0x7ec83be8, 0xfdb2c14b,
        0x97798900, 0xc982fcfc, 0xdf4f8f83, 0x2ad29cc0, 0x6f54554a, 0x5daf3523,
        0xc8726646, 0xd50e8af2,

    }};

static uint32_t kSpxEnabled = 0;

static void enable_spx_verify(void) { kSpxEnabled = 0; }

static void disable_spx_verify(void) { kSpxEnabled = kSigverifySpxDisabledOtp; }

uint32_t sigverify_spx_verify_enabled(lifecycle_state_t lc_state) {
  if (kSpxEnabled != kSigverifySpxDisabledOtp) {
    LOG_INFO("spx_verify is enabled");
  } else {
    LOG_INFO("spx_verify is disabled");
  }
  return kSpxEnabled;
}

static rom_error_t spx_success_to_ok_test_impl(uint32_t v, bool eq) {
  uint32_t res = sigverify_spx_success_to_ok(v);
  LOG_INFO("0x%08x -> 0x%08x", v, res);
  if ((res == kErrorOk) ^ eq) {
    LOG_ERROR("Wrong result 0x%08x for 0x%08x", res, v);
    return kErrorUnknown;
  }
  return kErrorOk;
}

static rom_error_t spx_success_to_ok_test(void) {
  bool failed = false;
  failed |=
      spx_success_to_ok_test_impl(kSigverifySpxDisabledOtp, true) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(kSigverifySpxSuccess, true) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(UINT32_MAX, false) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(0, false) != kErrorOk;
  failed |= spx_success_to_ok_test_impl(kErrorOk, false) != kErrorOk;
  if (failed) {
    return kErrorUnknown;
  }
  return kErrorOk;
}

static rom_error_t spx_verify_impl_test(void) {
  sigverify_spx_root_t expected_root;
  sigverify_spx_root_t actual_root;
  spx_public_key_root(kPubKey.data, expected_root.data);
  rom_error_t error =
      spx_verify(kSignature.data, NULL, 0, NULL, 0, (const uint8_t *)kMessage,
                 kMessageLen, kPubKey.data, actual_root.data);
  if (memcmp(&expected_root, &actual_root, sizeof(sigverify_spx_root_t)) != 0) {
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_disabled_bad_signature_test(void) {
  disable_spx_verify();

  uint32_t flash_exec = 0;
  uint32_t good_word = kSignature.data[0];
  kSignature.data[0] = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);
  kSignature.data[0] = good_word;

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_disabled_good_signature_test(void) {
  disable_spx_verify();

  uint32_t flash_exec = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

static rom_error_t spx_verify_enabled_bad_signature_test(void) {
  enable_spx_verify();

  uint32_t flash_exec = 0;
  uint32_t good_word = kSignature.data[0];
  kSignature.data[0] = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);
  kSignature.data[0] = good_word;

  if (error == kErrorOk) {
    LOG_ERROR("error should not be kErrorOk");
    return kErrorUnknown;
  }
  if (flash_exec != UINT32_MAX) {
    LOG_ERROR("flash_exec must be UINT32_MAX");
    return kErrorUnknown;
  }

  return kErrorOk;
}

static rom_error_t spx_verify_enabled_good_signature_test(void) {
  enable_spx_verify();

  uint32_t flash_exec = 0;
  rom_error_t error =
      sigverify_spx_verify(&kSignature, &kPubKey, kLcStateProd, NULL, 0, NULL,
                           0, &kMessage, kMessageLen, &flash_exec);

  if (flash_exec != kSigverifySpxSuccess) {
    LOG_ERROR("flash_exec must be 0x%08x, not 0x%08x", kSigverifySpxSuccess,
              flash_exec);
    return kErrorUnknown;
  }
  return error;
}

OTTF_DEFINE_TEST_CONFIG();

bool test_main(void) {
  (void)kPrivKey;  // Use `kPrivKey` to avoid unused variable warning.

  status_t error = OK_STATUS();

  EXECUTE_TEST(error, spx_success_to_ok_test);
  EXECUTE_TEST(error, spx_verify_impl_test);
  EXECUTE_TEST(error, spx_verify_disabled_bad_signature_test);
  EXECUTE_TEST(error, spx_verify_disabled_good_signature_test);
  EXECUTE_TEST(error, spx_verify_enabled_bad_signature_test);
  EXECUTE_TEST(error, spx_verify_enabled_good_signature_test);

  return status_ok(error);
}
